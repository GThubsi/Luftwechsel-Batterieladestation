<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batterieladestation Lüftungsrechner (Österreich)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* (Styles bleiben gleich wie im vorherigen Code) */
    </style>
</head>
<body>
    <!-- (HTML-Formular bleibt gleich wie im vorherigen Code) -->

    <script>
        const { jsPDF } = window.jspdf;

        function validateInputs() {
            const requiredInputs = [
                'raumlaenge', 'raumbreite', 'raumhoehe',
                'batteriekapazitaet', 'batteriespannung',
                'anzahl_batterien', 'h2_rate', 'max_h2'
            ];
            
            for (const id of requiredInputs) {
                const value = document.getElementById(id).value;
                if (value === "" || isNaN(parseFloat(value))) {
                    alert(`Bitte gültigen Wert für ${id} eingeben!`);
                    document.getElementById(id).focus();
                    return false;
                }
            }
            return true;
        }

        function berechnen() {
            if (!validateInputs()) return;

            // Raumabmessungen
            const laenge = parseFloat(document.getElementById('raumlaenge').value);
            const breite = parseFloat(document.getElementById('raumbreite').value);
            const hoehe = parseFloat(document.getElementById('raumhoehe').value);
            const lueftungstyp = document.getElementById('lueftungstyp').value;
            
            // Batteriedaten
            const batterietyp = document.getElementById('batterietyp').value;
            const kapazitaet = parseFloat(document.getElementById('batteriekapazitaet').value);
            const spannung = parseFloat(document.getElementById('batteriespannung').value);
            const anzahl = parseInt(document.getElementById('anzahl_batterien').value);
            
            // Lade- und Sicherheitsparameter
            const ladeverfahren = document.getElementById('ladeverfahren').value;
            const h2_rate = parseFloat(document.getElementById('h2_rate').value);
            const max_h2 = parseFloat(document.getElementById('max_h2').value) / 100; // Umwandlung in Dezimal
            const ex_zone = document.getElementById('ex_zone').value;
            
            // Berechnungen
            const raumvolumen = laenge * breite * hoehe;
            const h2_gesamt = h2_rate * anzahl;
            
            // Sicherstellen, dass max_h2 nicht 0 ist
            const safe_max_h2 = max_h2 <= 0 ? 0.01 : max_h2; 
            const luftwechsel_min = h2_gesamt / (raumvolumen * safe_max_h2);
            
            // Empfehlungen
            let luftwechsel_empfohlen = Math.max(6, luftwechsel_min);
            if (ladeverfahren === 'schnell') luftwechsel_empfohlen = Math.max(12, luftwechsel_min);
            
            const lueftungsleistung = raumvolumen * luftwechsel_empfohlen;
            
            // Explosionsschutz
            let ex_schutz = "Keine besonderen Maßnahmen";
            if (ex_zone === "0" || ex_zone === "1") {
                ex_schutz = "Ex-geschützte Geräte nach ATEX erforderlich";
            } else if (ex_zone === "2") {
                ex_schutz = "Ex-geschützte Geräte empfohlen";
            }
            
            // Weitere Maßnahmen
            let massnahmen = [];
            if (batterietyp === "blei") massnahmen.push("Neutralisationsmittel für Säurespritzer");
            if (batterietyp === "lithium") massnahmen.push("Lithium-Brandschutz (Klasse D-Löscher)");
            if (lueftungstyp === "natuerlich") massnahmen.push("Mechanische Lüftung nachrüsten");
            
            // Ergebnisse anzeigen
            document.getElementById('res_raumvolumen').textContent = raumvolumen.toFixed(2);
            document.getElementById('res_h2_gesamt').textContent = h2_gesamt.toFixed(4);
            document.getElementById('res_luftwechsel_min').textContent = luftwechsel_min.toFixed(3);
            document.getElementById('res_luftwechsel_empfohlen').textContent = luftwechsel_empfohlen.toFixed(1);
            document.getElementById('res_lueftungsleistung').textContent = Math.ceil(lueftungsleistung);
            document.getElementById('res_ex_schutz').textContent = ex_schutz;
            document.getElementById('res_massnahmen').textContent = massnahmen.join(", ") || "Keine zusätzlichen Maßnahmen";
            
            document.getElementById('result').style.display = 'block';
            document.getElementById('pdf-button').classList.remove('hidden');
            
            prepareReport();
        }

        /* (prepareReport() und generatePDF() bleiben gleich) */
    </script>
</body>
</html>
